/**
 * yjs - A framework for real-time p2p shared editing on any data
 * @version v12.3.1
 * @link http://y-js.org
 * @license MIT
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.yMemory=e()}}(function(){return function e(t,r,n){function i(l,o){if(!r[l]){if(!t[l]){var u="function"==typeof require&&require;if(!o&&u)return u(l,!0);if(a)return a(l,!0);var s=new Error("Cannot find module '"+l+"'");throw s.code="MODULE_NOT_FOUND",s}var f=r[l]={exports:{}};t[l][0].call(f.exports,function(e){var r=t[l][1][e];return i(r||e)},f,f.exports,e,t,r,n)}return r[l].exports}for(var a="function"==typeof require&&require,l=0;l<n.length;l++)i(n[l]);return i}({1:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(t){e("./RedBlackTree.js")(t);var r=function(e){function t(e){n(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.store=e,r.ss=e.ss,r.os=e.os,r.ds=e.ds,r}return a(t,e),t}(t.Transaction),l=t.utils.RBTree,s=t.utils.createSmallLookupBuffer(l),f=function(e){function t(e,r){n(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return a.os=new s,a.ds=new l,a.ss=new s,a}return a(t,e),o(t,[{key:"logTable",value:function(){this.requestTransaction(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("User: ",this.store.y.connector.userId,"=============================="),e.t0=console,e.delegateYield(this.getStateSet(),"t1",3);case 3:return e.t2=e.t1,e.t0.log.call(e.t0,"State Set (SS):",e.t2),console.log("Operation Store (OS):"),e.delegateYield(this.os.logTable(),"t3",7);case 7:return console.log("Deletion Store (DS):"),e.delegateYield(this.ds.logTable(),"t4",9);case 9:(this.store.gc1.length>0||this.store.gc2.length>0)&&console.warn("GC1|2 not empty!",this.store.gc1,this.store.gc2),"{}"!==JSON.stringify(this.store.listenersById)&&console.warn("listenersById not empty!"),"[]"!==JSON.stringify(this.store.listenersByIdExecuteNow)&&console.warn("listenersByIdExecuteNow not empty!"),this.store.transactionInProgress&&console.warn("Transaction still in progress!");case 13:case"end":return e.stop()}},e,this)}),!0)}},{key:"transact",value:function(e){for(var t=new r(this);null!==e;){for(var n=e.call(t),i=n.next();!i.done;)i=n.next(i.value);e=this.getNextRequest()}}},{key:"destroy",value:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),"t0",1);case 1:delete this.os,delete this.ss,delete this.ds;case 4:case"end":return e.stop()}},e,this)})}]),t}(t.AbstractDatabase);t.extend("memory",f)}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var l=i.get;if(void 0!==l)return l.call(n)};t.exports=l,"undefined"!=typeof Y&&l(Y)},{"./RedBlackTree.js":2}],2:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.exports=function(e){var t=function(){function e(t){if(n(this,e),this.val=t,this.color=!0,this._left=null,this._right=null,this._parent=null,null===t.id)throw new Error("You must define id!")}return a(e,[{key:"isRed",value:function(){return this.color}},{key:"isBlack",value:function(){return!this.color}},{key:"redden",value:function(){return this.color=!0,this}},{key:"blacken",value:function(){return this.color=!1,this}},{key:"rotateLeft",value:function(e){var t=this.parent,r=this.right,n=this.right.left;if(r.left=this,this.right=n,null===t)e.root=r,r._parent=null;else if(t.left===this)t.left=r;else{if(t.right!==this)throw new Error("The elements are wrongly connected!");t.right=r}}},{key:"next",value:function(){if(null!==this.right){for(var e=this.right;null!==e.left;)e=e.left;return e}for(var t=this;null!==t.parent&&t!==t.parent.left;)t=t.parent;return t.parent}},{key:"prev",value:function(){if(null!==this.left){for(var e=this.left;null!==e.right;)e=e.right;return e}for(var t=this;null!==t.parent&&t!==t.parent.right;)t=t.parent;return t.parent}},{key:"rotateRight",value:function(e){var t=this.parent,r=this.left,n=this.left.right;if(r.right=this,this.left=n,null===t)e.root=r,r._parent=null;else if(t.left===this)t.left=r;else{if(t.right!==this)throw new Error("The elements are wrongly connected!");t.right=r}}},{key:"getUncle",value:function(){return this.parent===this.parent.parent.left?this.parent.parent.right:this.parent.parent.left}},{key:"grandparent",get:function(){return this.parent.parent}},{key:"parent",get:function(){return this._parent}},{key:"sibling",get:function(){return this===this.parent.left?this.parent.right:this.parent.left}},{key:"left",get:function(){return this._left},set:function(e){null!==e&&(e._parent=this),this._left=e}},{key:"right",get:function(){return this._right},set:function(e){null!==e&&(e._parent=this),this._right=e}}]),e}(),r=function(){function r(){n(this,r),this.root=null,this.length=0}return a(r,[{key:"findNext",value:regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this.findWithLowerBound([t[0],t[1]+1]),"t0",1);case 1:return e.abrupt("return",e.t0);case 2:case"end":return e.stop()}},e,this)})},{key:"findPrev",value:regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this.findWithUpperBound([t[0],t[1]-1]),"t0",1);case 1:return e.abrupt("return",e.t0);case 2:case"end":return e.stop()}},e,this)})},{key:"findNodeWithLowerBound",value:function(t){if(void 0===t)throw new Error("You must define from!");var r=this.root;if(null===r)return null;for(;;)if(null!==t&&!e.utils.smaller(t,r.val.id)||null===r.left){if(null===t||!e.utils.smaller(r.val.id,t))return r;if(null===r.right)return r.next();r=r.right}else r=r.left}},{key:"findNodeWithUpperBound",value:function(t){if(void 0===t)throw new Error("You must define from!");var r=this.root;if(null===r)return null;for(;;)if(null!==t&&!e.utils.smaller(r.val.id,t)||null===r.right){if(null===t||!e.utils.smaller(t,r.val.id))return r;if(null===r.left)return r.prev();r=r.left}else r=r.right}},{key:"findSmallestNode",value:function(){for(var e=this.root;null!=e&&null!=e.left;)e=e.left;return e}},{key:"findWithLowerBound",value:regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.findNodeWithLowerBound(t),e.abrupt("return",null==r?null:r.val);case 2:case"end":return e.stop()}},e,this)})},{key:"findWithUpperBound",value:regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.findNodeWithUpperBound(t),e.abrupt("return",null==r?null:r.val);case 2:case"end":return e.stop()}},e,this)})},{key:"iterate",value:regeneratorRuntime.mark(function t(r,n,i,a){var l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:l=null===n?this.findSmallestNode():this.findNodeWithLowerBound(n);case 1:if(null===l||null!==i&&!e.utils.smaller(l.val.id,i)&&!e.utils.compareIds(l.val.id,i)){t.next=6;break}return t.delegateYield(a.call(r,l.val),"t0",3);case 3:l=l.next(),t.next=1;break;case 6:return t.abrupt("return",!0);case 7:case"end":return t.stop()}},t,this)})},{key:"logTable",value:regeneratorRuntime.mark(function e(t,r,n){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null==n&&(n=function(){return!0}),null==t&&(t=null),null==r&&(r=null),a=[],e.delegateYield(this.iterate(this,t,r,regeneratorRuntime.mark(function e(t){var r,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n(t)){r={};for(l in t)"object"===i(t[l])?r[l]=JSON.stringify(t[l]):r[l]=t[l];a.push(r)}case 1:case"end":return e.stop()}},e,this)})),"t0",5);case 5:null!=console.table&&console.table(a);case 6:case"end":return e.stop()}},e,this)})},{key:"find",value:regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(r=this.findNode(t))?r.val:null);case 1:case"end":return e.stop()}},e,this)})},{key:"findNode",value:function(t){if(null==t||t.constructor!==Array)throw new Error("Expect id to be an array!");var r=this.root;if(null===r)return!1;for(;;){if(null===r)return!1;if(e.utils.smaller(t,r.val.id))r=r.left;else{if(!e.utils.smaller(r.val.id,t))return r;r=r.right}}}},{key:"delete",value:regeneratorRuntime.mark(function e(r){var n,i,a,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.constructor===Array){e.next=2;break}throw new Error("id is expected to be an Array!");case 2:if(null!=(n=this.findNode(r))){e.next=5;break}return e.abrupt("return");case 5:if(this.length--,null!==n.left&&null!==n.right){for(i=n.left;null!==i.right;)i=i.right;n.val=i.val,n=i}if(l=n.left||n.right,null===l?(a=!0,l=new t({id:0}),l.blacken(),n.right=l):a=!1,null!==n.parent){e.next=14;break}return a?this.root=null:(this.root=l,l.blacken(),l._parent=null),e.abrupt("return");case 14:if(n.parent.left!==n){e.next=18;break}n.parent.left=l,e.next=23;break;case 18:if(n.parent.right!==n){e.next=22;break}n.parent.right=l,e.next=23;break;case 22:throw new Error("Impossible!");case 23:if(n.isBlack()&&(l.isRed()?l.blacken():this._fixDelete(l)),this.root.blacken(),!a){e.next=35;break}if(l.parent.left!==l){e.next=30;break}l.parent.left=null,e.next=35;break;case 30:if(l.parent.right!==l){e.next=34;break}l.parent.right=null,e.next=35;break;case 34:throw new Error("Impossible #3");case 35:case"end":return e.stop()}},e,this)})},{key:"_fixDelete",value:function(e){function t(e){return null===e||e.isBlack()}function r(e){return null!==e&&e.isRed()}if(null!==e.parent){var n=e.sibling;if(r(n)){if(e.parent.redden(),n.blacken(),e===e.parent.left)e.parent.rotateLeft(this);else{if(e!==e.parent.right)throw new Error("Impossible #2");e.parent.rotateRight(this)}n=e.sibling}e.parent.isBlack()&&n.isBlack()&&t(n.left)&&t(n.right)?(n.redden(),this._fixDelete(e.parent)):e.parent.isRed()&&n.isBlack()&&t(n.left)&&t(n.right)?(n.redden(),e.parent.blacken()):(e===e.parent.left&&n.isBlack()&&r(n.left)&&t(n.right)?(n.redden(),n.left.blacken(),n.rotateRight(this),n=e.sibling):e===e.parent.right&&n.isBlack()&&r(n.right)&&t(n.left)&&(n.redden(),n.right.blacken(),n.rotateLeft(this),n=e.sibling),n.color=e.parent.color,e.parent.blacken(),e===e.parent.left?(n.right.blacken(),e.parent.rotateLeft(this)):(n.left.blacken(),e.parent.rotateRight(this)))}}},{key:"put",value:regeneratorRuntime.mark(function r(n){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=n&&null!=n.id&&n.id.constructor===Array){r.next=2;break}throw new Error("v is expected to have an id property which is an Array!");case 2:if(i=new t(n),null===this.root){r.next=31;break}a=this.root;case 5:if(!e.utils.smaller(i.val.id,a.val.id)){r.next=15;break}if(null!==a.left){r.next=12;break}return a.left=i,r.abrupt("break",28);case 12:a=a.left;case 13:r.next=26;break;case 15:if(!e.utils.smaller(a.val.id,i.val.id)){r.next=24;break}if(null!==a.right){r.next=21;break}return a.right=i,r.abrupt("break",28);case 21:a=a.right;case 22:r.next=26;break;case 24:return a.val=i.val,r.abrupt("return",a);case 26:r.next=5;break;case 28:this._fixInsert(i),r.next=32;break;case 31:this.root=i;case 32:return this.length++,this.root.blacken(),r.abrupt("return",i);case 35:case"end":return r.stop()}},r,this)})},{key:"_fixInsert",value:function(e){if(null===e.parent)return void e.blacken();if(!e.parent.isBlack()){var t=e.getUncle();null!==t&&t.isRed()?(e.parent.blacken(),t.blacken(),e.grandparent.redden(),this._fixInsert(e.grandparent)):(e===e.parent.right&&e.parent===e.grandparent.left?(e.parent.rotateLeft(this),e=e.left):e===e.parent.left&&e.parent===e.grandparent.right&&(e.parent.rotateRight(this),e=e.right),e.parent.blacken(),e.grandparent.redden(),e===e.parent.left?e.grandparent.rotateRight(this):e.grandparent.rotateLeft(this))}}},{key:"flush",value:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)})}]),r}();e.utils.RBTree=r}},{}]},{},[1])(1)});
//# sourceMappingURL=y-memory.js.map
